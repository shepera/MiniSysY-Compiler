# Lab3

林璐霞 18377149

- 简要介绍，你在完成这个 lab 中的各个 part 时都做了哪些工作，为什么要用（你采用的）这种方法完成。
- 实验指导中每个 part 中留下的思考题的回答。（鼓励但不强制，这不会成为评分依据）
- 如果你复用或者借鉴了参考代码或其他实现（关于借鉴与抄袭的界定请见诚信页），请明确写出你借鉴了哪些内容。



## Part5

### 实现

在grmmar文件中增加了声明语句。

修改`ir-list-generator.rkt`：

* 增加了对各类声明的语句的实现。
* 所有的符号表都用一个hash存。每个block有自己的hash，全局变量也有自己的符号表hash（虽然还没用到）。在声明新变量的时候，会加到目前为止最里面的hash中。当需要变量的值的时候，会反过来一层层向外找。当传递给每个`Exp`等非终结符的时候，传递的是hash的列表（其实是个栈），越里面的排在越前面。哈希能让查找变得比较快，按照栈的方式存可以方便处理各个局部变量，靠内部的hash表存在开头只是racket语言中这样效率应该比较高。

* 为之前所有的实现的Exp及其子类增加了一个const模式，会在应该使用常量的模式下检查所有引用的变量是否是常量。默认情况下是变量模式，不需要做额外的检查。



## Part6

### 实现

`ir-list-generator.rkt`：

* 增加了对函数调用的库函数实现。
* 增加了一个全局的hash `lib-func`，存了所有的库函数信息。当调用函数的时候，会去那个哈希表检查是否有这个函数。
* 增加了一个全局的集合`func-include`，记录这段程序里用到过的库函数。只有用过的库函数才会在生成的llvm ir中被declare。（虽然感觉应该可以不管用没用到的函数一起declare，但感觉不太好，实际的编译器应该不是做这么的。虽然实际的编译器应该也不是我这么做的，应该不会存一个表来把所有函数都放在那里）。

